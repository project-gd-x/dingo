values:
  cfg: '*github.com/project-gd-x/cfg-pkg.SendEmail'
  version: string

services:
  SendEmail:
    type: '*github.com/project-gd-x/dingo/dingotest/go-sub-pkg.SendEmail'
    interface: EmailSender
    properties:
      From: '"hi@welcome.com"'

  SendEmail2:
    type: '*github.com/project-gd-x/dingo/go-sub-pkg.SendEmail'
    interface: 'github.com/project-gd-x/dingo/go-sub-pkg.EmailSender'
    constructor:
      name: NewEmailSender
      arguments:
        - '@{CustomerWelcome}'
        - '@{SomeEnv}'
        - '#{cfg.Elastic}'
        - '#{version}'

  CustomerWelcome:
    type: '*CustomerWelcome'
    returns: NewCustomerWelcome(@{SendEmail})

  WithEnv1:
    type: SendEmail
    properties:
      From: ${ShouldBeSet}

  WithEnv2:
    type: '*SendEmail'
    properties:
      From: '"foo-" + ${ShouldBeSet} + "-bar"'

  SomeEnv:
    type: string
    returns: ${ShouldBeSet}

  Now:
    type: time.Time
    returns: time.Now()
    scope: prototype

  ParsedTime:
    type: time.Time
    scope: prototype
    arguments:
      value: string
    returns: time.Parse(time.RFC822, value)
    error: return time.Now()

  DependsOnTime:
    type: time.Time
    scope: prototype
    returns: '@{ParsedTime("13 Jan 06 15:04 MST")}'

  OtherPkg:
    type: '*github.com/project-gd-x/dingo/dingotest/go-sub-pkg.Person'

  OtherPkg2:
    type: '*github.com/project-gd-x/dingo/dingotest/go-sub-pkg.Person'
    interface: github.com/project-gd-x/dingo/dingotest/go-sub-pkg.Greeter
    returns: go_sub_pkg.NewPerson()

  OtherPkg3:
    type: github.com/project-gd-x/dingo/dingotest/go-sub-pkg.Person

  SendEmailError:
    type: '*SendEmail'
    returns: NewSendEmail()
    error: panic(err)

  AFunc:
    type: func (int, int) (bool, bool)
    returns: |
      func (a, b int) (c, d bool) {
        c = (a + b) != 0
        d = @{SomeEnv} != ""

        return
      }

  Clock:
    interface: github.com/jonboulle/clockwork.Clock
    returns: clockwork.NewRealClock()

  WhatsTheTime:
    type: '*WhatsTheTime'
    properties:

      clock: '@{Clock}'

  Signer:
    type: '*Signer'
    scope: prototype        # Create a new Signer each time
    arguments:              # Define the dependencies at runtime.
      req: '*http.Request'
    import:
      - net/http
    returns: NewSigner(req) # Setup code can reference the runtime dependencies.

  HTTPSignerClient:
    type: '*HTTPSignerClient'
    properties:
      CreateSigner: '@{Signer}'
